(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{540:function(t,a,s){t.exports=s.p+"assets/img/ref1.6654bb1a.jpg"},541:function(t,a,s){t.exports=s.p+"assets/img/ref2.32222a29.jpg"},542:function(t,a,s){t.exports=s.p+"assets/img/ref3.e416946c.jpg"},614:function(t,a,s){"use strict";s.r(a);var n=s(24),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"如何将你的业务数据变成参照"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何将你的业务数据变成参照"}},[t._v("#")]),t._v(" 如何将你的业务数据变成参照")]),t._v(" "),n("h3",{attrs:{id:"_1-配置一个参照卡页"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置一个参照卡页"}},[t._v("#")]),t._v(" 1.配置一个参照卡页")]),t._v(" "),n("p",[t._v("这里以wbs模板(pgrm_wbstemplate_ref)参照为例,创建一个卡页,随便给他起个名字.一般ref结尾.")]),t._v(" "),n("p",[t._v("数据源就配置你的元数据的数据源就行了,然后显示字段就id,code,name")]),t._v(" "),n("p",[n("img",{attrs:{src:s(540),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"_2-注册pub-ref"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-注册pub-ref"}},[t._v("#")]),t._v(" 2.注册pub_ref")]),t._v(" "),n("p",[t._v("这个是借用groovy工具写的.注意一个参数,datasourcetype,这个会决定你的参照由谁处理.详细看3")]),t._v(" "),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[t._v("helper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("execute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"delete from pub_ref where code = 'pgrm_wbstemplate_ref';\"")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nhelper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("executeInsertValues"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'''\nINSERT INTO `pub_ref` (\n    `code`,\n    `name`,\n    `description`,\n    `reftype`,\n    `isorgrel`,\n    `datasourcetype`,\n    `datasourcesql`,\n    `datasourcegridsql`,\n    `iparentrefid`,\n    `csub_id`,\n    `centitykeyfld`,\n    `ctpltype`,\n    `centitynamefld`,\n    `cretfld`,\n    `bmultisel`,\n    `creffiltersql`,\n    `cautocompletefiltersql`,\n    `bauth`,\n    `ccheckflds`,\n    `ctipprefix`,\n    `ctipfld`,\n    `ifilterstyle`,\n    `ishowstyle`,\n    `bpage`,\n    `lPageSize`,\n    `cdatagrid_fullname`,\n    `cdatagrid_classfk`,\n    `cdataclass_fullname`,\n    `cdataclass_refclsname`,\n    `bdataclass_rule`,\n    `bdataclass_retenddata`,\n    `cdataclass_lscode`,\n    `cdataclass_lsname`,\n    `cdataclass_sortfield`,\n    `clsname`,\n    `sortfield`,\n    `cbillnum`,\n    `eventbean`,\n    `svcKey`,\n    `cFilterId`,\n    `authType`,\n    `extendField`,\n    `domain`,\n    `treedomain`,\n    `name_resid`,\n    `extendField_resid`\n)\nVALUES\n(\n    '")]),t._v("pgrm_wbstemplate_ref"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    '")]),t._v("WBS模板参照"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    '")]),t._v("WBS模板参照"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    '")]),t._v("pgrm_wbstemplate_ref"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    NULL,\n    '")]),t._v("wbsTplRef"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    NULL,\n    NULL,\n    NULL,\n    '")]),t._v("PGRM"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    '")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    '")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Table")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    '")]),t._v("node"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    '")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    '")]),t._v("\\\\"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    '")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    NULL,\n    '")]),t._v("\\\\"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    '")]),t._v("code"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    NULL,\n    NULL,\n    NULL,\n    NULL,\n    '")]),t._v("\\u0001"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    NULL,\n    '")]),t._v("pgrm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wbstemplate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("WbsTemplate"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    '")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    NULL,\n    NULL,\n    '")]),t._v("\\\\"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    '")]),t._v("\\\\"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    NULL,\n    NULL,\n    '")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    NULL,\n    NULL,\n    '")]),t._v("pgrm_wbstemplate_ref"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("',\n    NULL,\n    NULL,\n    NULL,\n    NULL,\n    NULL,\n    NULL,\n    NULL,\n    NULL,\n    NULL\n);\n'''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h3",{attrs:{id:"_3-重写refer查询器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-重写refer查询器"}},[t._v("#")]),t._v(" 3.重写Refer查询器.")]),t._v(" "),n("p",[t._v("上面说到的"),n("code",[t._v("datasourcetype")]),t._v(",这个字段,会决定程序到哪里去找你的"),n("code",[t._v("refer")]),t._v("查询器.下面详细看看.")]),t._v(" "),n("p",[t._v("源码里"),n("code",[t._v("RefService")]),t._v(",这个"),n("code",[t._v("getGridData()")]),t._v("方法,里面有段代码,是说去找默认的方法还是自定义方法的.")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//这是摘的源码")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("entity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("datasourceType "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" entity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("datasourceType"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isEmpty")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" entity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("datasourceType"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("equalsIgnoreCase")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MddConstants")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TYPE_ENTITY_DATASOURCE_META"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" datasourceType "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MddConstants")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TYPE_ENTITY_DATASOURCE_META"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 获取指定名称的IRefDataHandler实现类，name命名规则为 entity.datasourceType + "RefDataHandler"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IExtRefDataHandler")]),t._v(" refDataHanlder "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AppContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBean")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("datasourceType "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ExtRefDataHandler"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IExtRefDataHandler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            rev "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" refDataHanlder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getGridData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("billContext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" entity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" refpara"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 支持自定义扩展类型")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" datasourceType "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" entity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("datasourceType"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 获取指定名称的IRefDataHandler实现类，name命名规则为 entity.datasourceType + "RefDataHandler"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IExtRefDataHandler")]),t._v(" refDataHanlder "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AppContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBean")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("datasourceType "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ExtRefDataHandler"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IExtRefDataHandler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            rev "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" refDataHanlder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getGridData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("billContext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" entity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" refpara"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("截图看看:")]),t._v(" "),n("p",[n("img",{attrs:{src:s(541),alt:""}})]),t._v(" "),n("p",[t._v("看,如果你没有指定,或者指定的meta,他都会走默认的,MetaExtRefDataHandler,如果你重写了,那就是会走你自己的"),n("code",[t._v("datasourceType+ExtRefDataHandler")]),t._v(",自定义参照查询器.")]),t._v(" "),n("p",[t._v("需要注意的是,如果自己写查询器,最后要返回一个Pager,这里有分页信息,需要自己处理下.")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Pager")]),t._v(" pager "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Pager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setPageIndex")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setPageSize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRecordCount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wbsTemplateDtoList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRecordList")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wbsTemplateDtoList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setPageCount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" pager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("可以参照"),n("code",[t._v("wbsTplRefExtRefDataHandler")]),t._v("这个类,在计划中台.")]),t._v(" "),n("p",[n("img",{attrs:{src:s(542),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"_4-自定义refer查询器注意的点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-自定义refer查询器注意的点"}},[t._v("#")]),t._v(" 4.自定义Refer查询器注意的点.")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("除了自己的条件需要处理以外.")]),t._v(" "),n("p",[t._v("自己的参数都在实现接口的map参数的condition中,"),n("code",[t._v('map.get("condition");')])])]),t._v(" "),n("li",[n("p",[t._v("需要注意模糊查询的处理.")]),t._v(" "),n("p",[t._v("模糊查询就是重新调用接口,但是参数直接在map中.")])]),t._v(" "),n("li",[n("p",[t._v("除了模糊查询,还有精准查询,精准查询的条件也在"),n("code",[t._v('map.get("condition");')]),t._v("中,但是取时候要注意,他是自己封装了一个conditions")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);